#

## 비동기와 이벤트 루프

<img src="https://github.com/RanungPark/F-LAB/assets/104816866/74fbc2b0-4406-419b-9f4d-f21f6e0820cd"  width="500" height="400"/>

자바스크립트는 콜 스택을 하나만 보유하여 싱글 스레드이다.

이 때문에 한번에 하나의 작업만 진행 할 수 있지만 이렇게 진행된다면 속도가 매우 느릴 것이다.

이를 보안하기 위하여 브라우저에서 비동기적으로 작업을 이루어 질 수 있도록 보안되었다.

브라우저에는 Callback Queue와 WebApIs가 있고 이들과 자바스크립트에 있는 Callstack을 루프를 돌며 비동기 함수들을 적절한 시점에 실행시키는 관리자인 EventLoop가 있다

**콜 스택:** 자바스크립트 엔진이 실행할 코드가 적재되는 곳

**힙:** 객체와 같이 동적으로 크기가 변할 수 있는 변수를 저장하는 곳

**WebAPI:** 브라우저에서 제공하는 API로 비동기적으로 실행할 작업을 전담하여 처리한다(WebAPIs는 비동기와 동기를 섞어서 사용한다 비동기 작업만 하지 않는다)

**콜백 큐:** 비동기 작업이 완료된다면 콜 스택으로 이동하기 전에 대기하는 공간

**이벤트 루프:** 콜스택, WebAPIs, 콜백 큐를 돌며 비동기 작업을 적절한 시점에 진행시키도록 관리자

1. 콜 스택에서 비동기 함수(setTimeout(), fetch(), 이벤트 DOM)가 발견되면 이벤트 루프가 WebAPIs에 이들을 실행하도록 옮기고 콜 스택은 다음 코드를 처리한다.
2. WebAPIs에서 setTimeout이 기다릴 시간이 완료되거나 또는 fetch로 API통신이 완려되거나, 이벤트가 발생하는 등 비동기 작업이 진행되었다면 이를 이벤트 루프가 콜백 큐로 옮긴다.
3. 콜백 큐는 콜 스택에 적재된 코드가 모두 끝날 때까지 대기한다.
4. 콜 스택에 적재된 모든 코드가 끝났다면 이벤트 루프는 콜백 큐에서 가장 오래 대기한 함수를 콜 스택에 적재시켜 실행시킨다.
5. 이떄 콜백 큐에서 꺼내는 순서가 있는데 Take Queue와 Microtake Queue중 Microtake Queue가 우선순위가 더 높다.
6. Microtake Queue는 대표적으로 Promise.then이 있으며 Take Queue에는 setTimeout과 fetch등이 있다.

---

https://dev.to/lydiahallie
